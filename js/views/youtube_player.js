define(["jquery","underscore","backbone","./youtube/track_info","./youtube/playlist_info","text!templates/youtube_custom_styles.css"],function(e,t,n,r,i,s){var o=n.View.extend({el:"#youtube-player-container",events:{"click .show-player":"show","click .pause":"pause","click .play":"playVideo","click .volume-down":"decreaseVolume","click .volume-up":"increaseVolume","click .next":"playNext","click .previous":"playPrevious","click .fullscreen":"toggleFullScreen","mouseout .volume-down":"hideVolume","mouseout .volume-up":"hideVolume","mouseover .volume-down":"showVolume","mouseover .volume-up":"showVolume","mouseover .volume-meter":"showVolume"},initialize:function(){this.model.on("change:play",this.play,this),this.model.on("change:mediaOptions",this.onMediaOptionsChange,this),this.currentTrackInfoView=new r({el:this.$(".current-track-info-container"),model:this.model.youtube().get("info")}),this.currentPlaylistView=new i({el:this.$(".playlist-info"),model:this.model}),this.currentTrackInfoView.on("seek",this.seekToSeconds,this),this.visibile=!1,this.isFullscreen=!1,this.insertCustomStyles(),e(window).on("resize",t.bind(this.insertCustomStyles,this)),window.onYouTubeIframeAPIReady=t.bind(this.createPlayer,this);var n=require(["http://www.youtube.com/iframe_api?&ghost="],function(){})},createPlayer:function(){this.player=new YT.Player("player",{height:"270",width:"300",playerVars:{autoplay:0,enablejsapi:1},events:{onReady:e.proxy(this.onPlayerReady,this),onStateChange:e.proxy(this.onPlayerStateChange,this)}})},onPlayerReady:function(){this.queue&&this.play(this.queue),this.updateVolume(this.player.getVolume())},onPlayerStateChange:function(e){var t=this.model.get("mediaOptions").type==="playlist"||!1,n;e.data===YT.PlayerState.PAUSED&&this.toggleNowPlaying(!1),e.data===YT.PlayerState.PLAYING&&(t&&(n=this.player.getPlaylistIndex(),this.model.set("mediaId",this.player.getPlaylist()[n]),this.model.fetchPlaylistInfo(),this.updateIndex(n)),this.model.fetchCurrentMediaInfo(),this.toggleNowPlaying(!0))},play:function(e){var t=e.get("mediaId"),n=e.get("mediaOptions");if(!this.player||!this.player.loadVideoById){this.show(),this.queue=e;return}this.player.stopVideo(),this.player.clearVideo&&this.player.clearVideo(),this.playMedia(t,n),this.$el.addClass("yt-playing"),this.show(null,"show")},onMediaOptionsChange:function(e,t){this.updateIndex(t.index||0),this.player&&this.player.playVideoAt&&this.player.playVideoAt(parseInt(t.index,10))},updateIndex:function(e){this.model.set("currentIndex",e)},playMedia:function(e,n){var r=t.isObject(e)?e.id:e,i=n&&n.playlistId?n.playlistId:r,s=n.index?parseInt(n.index,10):0;n&&n.type==="playlist"?(this.player&&this.player.getPlaylistId()!==null&&this.player.playVideoAt(s),this.player.loadPlaylist({list:i,index:s,playlist:"playlist",suggestedQuality:"large"})):this.player.loadVideoById(r)},pause:function(){this.player.pauseVideo()},playVideo:function(){this.player.playVideo()},decreaseVolume:function(){this.updateVolume(this.player.getVolume()-5),this.showVolume()},increaseVolume:function(){this.updateVolume(this.player.getVolume()+5),this.showVolume()},updateVolume:function(e){e<0&&(e=0),e>=100&&(e=100),this.player.setVolume(e),this.$el.find(".volume-meter").html(Math.round(Math.abs(e)))},hideVolume:function(){this.$el.addClass("hide-volume")},showVolume:function(){this.$el.removeClass("hide-volume")},playNext:function(){this.player.nextVideo()},playPrevious:function(){this.player.previousVideo()},defaultSize:{width:300,height:270},toggleFullScreen:function(){var e=this.isFullscreen?this.defaultSize:t(["sidebar"]).getPortviewSize();this.isFullscreen=!this.isFullscreen,this.player.setSize(e.width,e.height),this.$el.toggleClass("fullscreen",this.isFullscreen)},toggleNowPlaying:function(e){this.$el.toggleClass("yt-playing",e)},show:function(e,t){e&&e.preventDefault(),!this.visible||t==="show"?(this.$el.addClass("show-youtube-player"),this.visible=!0):this.hide(e)},hide:function(e){e&&e.preventDefault(),this.$el.removeClass("show-youtube-player"),this.visible=!1},insertCustomStyles:function(){var e=t().getPortviewSize(),n=this.$("#youtube-full-screen");customStyle=t.template(s,e),n.length?n.replaceWith(customStyle):this.$el.append(customStyle)},seekToSeconds:function(e){this.player.seekTo(e,!0)}});return o});